---
- name: Create 'administrators' group
  ldap_entry:
    server_uri: "ldapi://%2fdata%2frun%2fslapd-localhost.socket"
    dn: "cn=administrators,ou=groups,{{ dirsrv_domain }}"
    objectClass:
      - top
      - groupOfNames
      - nsMemberOf
    attributes:
      cn: administrators
    state: present
  register: result
  retries: 5
  delay: 1
  until: result is not failed

- name: Assert 'administrators' group members
  ldap_attrs:
    server_uri: "ldapi://%2fdata%2frun%2fslapd-localhost.socket"
    dn: "cn=administrators,ou=groups,{{ dirsrv_domain }}"
    attributes:
      member: "uid={{ default_user_uid }},ou=people,{{ dirsrv_domain }}"
    state: exact
  register: result
  retries: 5
  delay: 1
  until: result is not failed
